<!DOCTYPE HTML>
<html>
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>ApnaOPD</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Free HTML5 Website Template by freehtml5.co" />
	<meta name="keywords" content="free website templates, free html5, free template, free bootstrap, free website template, html5, css3, mobile first, responsive" />
	<meta name="author" content="freehtml5.co" />

  	<!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

	<!-- <link href="https://fonts.googleapis.com/css?family=Work+Sans:300,400,500,700,800" rel="stylesheet">	 -->
	<link href="https://fonts.googleapis.com/css?family=Space+Mono" rel="stylesheet">
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="css/bootstrap.css">

	<!-- Magnific Popup -->
	<link rel="stylesheet" href="css/magnific-popup.css">

	<!-- Flexslider  -->
	<link rel="stylesheet" href="css/flexslider.css">

	<!-- Theme style  -->
	<link rel="stylesheet" href="css/style.css">

	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>

	<script type="text/javascript" src="http://code.jquery.com/jquery-compat-git.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->

	<style>
		.col-md-3, .col-md-2, .col-md-1 {
			padding: 2px 2px;
		}
	</style>

	</head>
	<body>
		
	<div class="fh5co-loader"></div>
	
	<div id="page">
	<nav class="fh5co-nav" role="navigation">
		<div class="top-menu">
			<div class="container-fluid">
				<div class="row">
					<div class="col-xs-2">
						<div id="fh5co-logo"><a href="index.html">ApnaOPD</a></div>
					</div>
					<div class="col-xs-10 text-right menu-1">
						<ul>
							<li><a href="index.html">Home</a></li>
							<!-- <li><a href="product.html">Product</a></li> -->
							<li><a onclick="patient_login()" href="#" >Patient</a></li>
							<li><a onclick="doctor_login()" href="#">Doctor</a></li>
							<li class="active"><a onclick="retailer_login()" href="#">Retailer</a></li>
							
							<li class="btn-cta"><a onclick="login()" href="#"><span>Login</span></a></li>
						</ul>
					</div>
				</div>
				
			</div>
		</div>
	</nav>
	

	<div id="fh5co-about">
		<div class="container">
			<div class="row animate-box">
				<div class="col-md-8 col-md-offset-2 text-center fh5co-heading">
					<h2>Order Detail</h2>
					<!-- <p>Dignissimos asperiores vitae velit veniam totam fuga molestias accusamus alias autem provident. Odit ab aliquam dolor eius.</p> -->
				</div>
			</div>
			<div class="row">
				<div class="member">
					<div class="member">
						<div class="col-md-1 nopadding animate-box">
						</div>
						<div class="col-md-10 nopadding animate-box" style="border: 1px solid #000;">
						<div id="demandDetailList" class="desc" style="margin-top:1em; margin-top:0;padding:1em; width:100%;">
							<div class="row">
								<div class="col-md-12">
									<img class="img-responsive" src="http://10.42.0.1:3000[[photo_prescription_link]]">
								</div>
							</div>
							<div class="row" style="border: 1px solid #ccc;padding: 10px; margin: 30px;">
								<div class="col-md-1"></div>
								<div class="col-md-3">
									<img src="[[imageUrl]]">
								</div>
								<div class="col-md-8">
									<p>[[name]]</p>
								</div>
							</div>
							<div class="row text-center">
								<div class="col-md-6">
									<button id="accept" class="btn btn-primary" onclick="showQuotationForm()">Accept</button>
								</div>
								<div class="col-md-6">
									<a href="#"><button class="btn btn-primary">Decline</button></a>
								</div>
							</div>
						</div>
						</div>
					</div>
						<div class="col-md-1 nopadding animate-box">
						</div>
					</div>
				</div>
				
				
			</div>
		</div>
	</div>


	<!-- Quotation Box -->

	<div id="quotationBox" class="container" style="display: none;">
		<div class="text-center" style="margin-top: 30px;"><p class="lead">Fill Quotation Details :</p></div>


		<div class="multi-field-wrapper">
            <div class="multi-fields">
                <div class="multi-field" style="margin-bottom: 15px;">
                	<input class="form-control" type="text" placeholder="Drug Name" name="drug_name" style="display: inline; width: 30%;">
                	<input class="form-control" type="text" placeholder="Price" name="price" style="display: inline; width: 15%;">
                	<input class="form-control" type="text" placeholder="Offer Price" name="offer_price" style="display: inline; width: 15%;">
                	<input class="form-control" type="text" placeholder="Dosage/Day" name="dosage" style="display: inline; width: 15%;">
                	<input class="form-control" type="text" placeholder="Days" name="duration" style="display: inline; width: 15%;">
                	<button class="remove-field" type="button" style="margin-top: 4px; width: 5%;">-</button>
                </div>
            </div>
            <button type="button" class="add-field">+</button>
            <p>Total Offer Price : <span class="form-control" id="total_offer_price" style="display: inline;">0.0</span></p>
            <label>Delivery Charge :&nbsp;</label><input class="form-control" type="text" id="delivery_charge" name="delivery_charge" style="display: inline; width: 30%; margin-bottom: 5px">
            <br>
            <label>Delivery Time &nbsp;&nbsp;:&nbsp;</label><input class="form-control" type="text" id="delivery_time" name="delivery_time" style="display: inline; width: 30%; margin-bottom: 30px;">
            <p>Total Charge &nbsp;&nbsp;&nbsp;&nbsp;: <span class="form-control" id="total_charge" style="display: inline;">0.0</span></p>
            <button type="button" class="btn btn-lg btn-primary pull-right" onclick="confirmQuotation()">Send</button>
        </div>

	</div>


    <footer id="fh5co-footer" role="contentinfo">
		<div class="container">
			<div class="row row-pb-md">
				<div class="col-md-4 fh5co-widget">
					<h4>ApnaOPD</h4>
					<p>Facilis ipsum reprehenderit nemo molestias. Aut cum mollitia reprehenderit. Eos cumque dicta adipisci architecto culpa amet.</p>
				</div>
				<div class="col-md-4 col-md-push-1">
					<h4>Links</h4>
					<ul class="fh5co-footer-links">
						<li><a href="index.html">Home</a></li>
						<li><a href="#">About us</a></li>
					</ul>
				</div>

				<div class="col-md-4 col-md-push-1">
					<h4>Contact Information</h4>
					<ul class="fh5co-footer-links">
						<li>Adityapur ,Jamshedpur <br>JH  INDIA 831012</li>
						<li><a href="tel://1234567920">+ 1235 2355 98</a></li>
						<li><a href="mailto:info@yoursite.com">email : ApnaOPD</a></li>
					</ul>
				</div>

			</div>

			<div class="row copyright">
				<div class="col-md-12 text-center">
					<p>
						<small class="block">&copy; 2018 ApnaOPD. All Rights Reserved.</small> 
						<!-- <small class="block">Designed by <a href="http://freehtml5.co/" target="_blank">FreeHTML5.co</a> Demo Images: <a href="http://unsplash.co/" target="_blank">Unsplash</a></small> -->
					</p>
					<p>
						<ul class="fh5co-social-icons">
							<li><a href="#"><i class="icon-facebook"></i></a></li>
							<li><a href="#"><i class="icon-linkedin"></i></a></li>
							<li><a href="#"><i class="icon-dribbble"></i></a></li>
						</ul>
					</p>
				</div>
			</div>

		</div>
	</footer>
	</div>

	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="icon-arrow-up"></i></a>
	</div>
	
	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Flexslider -->
	<script src="js/jquery.flexslider-min.js"></script>
	<!-- Magnific Popup -->
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/magnific-popup-options.js"></script>
	<!-- Main -->
	<script src="js/main.js"></script>
	<script src="js/login_module.js"></script>

	<script src="js/jquery.miranda.min.js"></script>


	<script>

		    function showQuotationForm(){
		        $("#quotationBox").slideDown("slow");
		    }

		var did = sessionStorage.getItem('demand_id');

		function confirmQuotation() {
			var nameList = $('.multi-field input[name=drug_name]');
			var priceList = $('.multi-field input[name=price]');
			var offerPriceList = $('.multi-field input[name=offer_price]');
			var dosageList = $('.multi-field input[name=dosage]');
			var durationList = $('.multi-field input[name=duration]');
			// console.log(drugList);
			var drugArray = [],price=0;
			for(var i = 0; i < nameList.length; i++) {
				price+= parseFloat(offerPriceList[i].value);
				var obj = {
					'medicine' : nameList[i].value,
					'price' : priceList[i].value,
					'offered_price' : offerPriceList[i].value,
					'dosage_per' : dosageList[i].value,
					'dosage_day' : durationList[i].value
				};
				drugArray.push(obj);
			}
			// console.log(drugArray);
			var dc,dt;
				$(function() {   
	                dc = $('#delivery_charge');  
	                dt = $('#delivery_time');
	                //console.log(dc.val(), dt.val()); 
	                if (dc.val() == '' || dt.val() == '') {  
	                    alert('please enter delivery charge and delivery time');  
	                } 
	        });

	        var offer = {
	        	retailer_gid : sessionStorage.getItem('retailer_gid'),
	        	quotation : drugArray,
	        	total_price : $("#total_offer_price").text(),
	        	quotation_link : '/files/quotations/1/index.jpg',
	        	delivery_time : dt.val(),
	        	delivery_charge : dc.val()
	        }
	        var offers = {
	        	offers : offer
	        }
	        console.log(offers);
	        $.ajax({
		            type        : 'PUT', 
		            url         : 'http://192.168.43.193:3000/api/orders/'+did,
		            contentType : "application/json",
		            data        : JSON.stringify(offers),
		            dataType    : 'json',
		            encode      : true
		        })
		        .done(function(data) {

		            console.log(data);
		            //window.location.href = "show_doctors.html"; 

		        });
		}

		$.ajax({

		        type        : 'GET', 
		        url         : 'http://192.168.43.193:3000/api/orders/'+did,
		    })
		    .done(function(data) {
		    	console.log(data);
		    	$('#demandDetailList').mirandajs(data);
		    	$.ajax({

		        type        : 'GET', 
		        url         : 'http://192.168.43.193:3000/api/users/'+data.patient_gid,
		    })
		    .done(function(data) {
		    	console.log(data);
		    	$('#demandDetailList').mirandajs(data);
		    });
		    	
		});

	</script>
	<script>
		var current_total_offer_price;
		$(function() {
            $('.multi-field-wrapper').each(function() {
                var $wrapper = $('.multi-fields', this);
                $(".add-field", $(this)).click(function(e) {
                    $('.multi-field:first-child', $wrapper).clone(true).appendTo($wrapper).find('input').val('');
                    var show_price = $('.multi-field input[name=offer_price]');
                    current_total_offer_price=0;
                    for(var i=0;i<show_price.length;i++) {
                    	if(show_price[i].value!='')
                    	{
                    	current_total_offer_price += parseFloat(show_price[i].value);

                    	$("#total_offer_price").text(current_total_offer_price);
                    	}
                    }

                });
                $('.multi-field .remove-field', $wrapper).click(function() {
                    if ($('.multi-field', $wrapper).length > 1)
                        $(this).parent('.multi-field').remove();
                });
            });
        });

        $("#delivery_charge").focusout(function() {
        	var top = $("#total_offer_price").text();
        	var dc = $("#delivery_charge").val();
        	console.log(top, dc);
        	$("#total_charge").text(parseFloat(top) + parseFloat(dc));
        });

	</script>
	</body>
</html>