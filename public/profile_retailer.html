<!DOCTYPE HTML>
<html>
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>ApnaOPD</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Free HTML5 Website Template by freehtml5.co" />
	<meta name="keywords" content="free website templates, free html5, free template, free bootstrap, free website template, html5, css3, mobile first, responsive" />
	<meta name="author" content="freehtml5.co" />

  	<!-- Facebook and Twitter integration -->
	<meta property="og:title" content=""/>
	<meta property="og:image" content=""/>
	<meta property="og:url" content=""/>
	<meta property="og:site_name" content=""/>
	<meta property="og:description" content=""/>
	<meta name="twitter:title" content="" />
	<meta name="twitter:image" content="" />
	<meta name="twitter:url" content="" />
	<meta name="twitter:card" content="" />

	<!-- <link href="https://fonts.googleapis.com/css?family=Work+Sans:300,400,500,700,800" rel="stylesheet">	 -->
	<link href="https://fonts.googleapis.com/css?family=Space+Mono" rel="stylesheet">
	
	<!-- Animate.css -->
	<link rel="stylesheet" href="css/animate.css">
	<!-- Icomoon Icon Fonts-->
	<link rel="stylesheet" href="css/icomoon.css">
	<!-- Bootstrap  -->
	<link rel="stylesheet" href="css/bootstrap.css">

	<!-- Magnific Popup -->
	<link rel="stylesheet" href="css/magnific-popup.css">

	<!-- Flexslider  -->
	<link rel="stylesheet" href="css/flexslider.css">

	<!-- Theme style  -->
	<link rel="stylesheet" href="css/style.css">

	<!-- Modernizr JS -->
	<script src="js/modernizr-2.6.2.min.js"></script>
	<!-- FOR IE9 below -->
	<!--[if lt IE 9]>
	<script src="js/respond.min.js"></script>
	<![endif]-->

	<style>
		#demandList::-webkit-scrollbar {
		    width: 6px;
		}

		/* Track */
		#demandList::-webkit-scrollbar-track {
		    box-shadow: inset 0 0 5px grey; 
		    border-radius: 10px;
		}
		 
		/* Handle */
		#demandList::-webkit-scrollbar-thumb {
		    background: green; 
		    border-radius: 10px;
		}

		/* Handle on hover */
		#demandList::-webkit-scrollbar-thumb:hover {
		    background: #b30000; 
		}

		#demand_body , #accepted_body {
			border: 1px solid #ddd;
			padding: 20px;
			margin-bottom: 15px;
		}

		#acceptedList::-webkit-scrollbar {
		    width: 6px;
		}

		/* Track */
		#acceptedList::-webkit-scrollbar-track {
		    box-shadow: inset 0 0 5px grey; 
		    border-radius: 10px;
		}
		 
		/* Handle */
		#acceptedList::-webkit-scrollbar-thumb {
		    background: green; 
		    border-radius: 10px;
		}

		/* Handle on hover */
		#acceptedList::-webkit-scrollbar-thumb:hover {
		    background: #b30000; 
		}

		.nav-tabs li {
			width: 25%;
			text-align: center;
			font-size: 20px;
			font-weight: bold;
		}

		.nav-tabs li.active a {
			color: #00960c;
		}

		.nav-tabs li a {
			color: #000;
		}
	</style>

		<style>
		/* The Modal (background) */
		.modal {
			display: none; /* Hidden by default */
			position: fixed; /* Stay in place */
			z-index: 1; /* Sit on top */
			padding-top: 100px; /* Location of the box */
			left: 0;
			top: 0;
			width: 100%; /* Full width */
			height: 100%; /* Full height */
			overflow: auto; /* Enable scroll if needed */
			background-color: rgb(0,0,0); /* Fallback color */
			background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
		}

		/* Modal Content */
		.modal-content {
			background-color: #fefefe;
			margin: auto;
			padding: 20px;
			border: 1px solid #888;
			width: 40%;
			text-align: -webkit-center;
		}

		/* The Close Button */
		.close {
			color: #aaaaaa;
			float: right;
			font-size: 28px;
			font-weight: bold;
		}

		.close:hover,
		.close:focus {
			color: #000;
			text-decoration: none;
			cursor: pointer;
		}

	</style>

	</head>
	<body>
		
	<div class="fh5co-loader"></div>
	
	<div id="page">
	<nav class="fh5co-nav" role="navigation">
		<div class="top-menu">
			<div class="container-fluid">
				<div class="row">
					<div class="col-xs-2">
						<div id="fh5co-logo"><a href="index.html">ApnaOPD</a></div>
					</div>
					<div class="col-xs-10 text-right menu-1">
						<ul>
							<li><a href="index.html">Home</a></li>
							<!-- <li><a href="product.html">Product</a></li> -->
							<li><a onclick="patient_login()" href="#" >Patient</a></li>
							<li><a onclick="doctor_login()" href="#">Doctor</a></li>
							<li class="active"><a onclick="retailer_login()" href="#">Retailer</a></li>
							
						</ul>
					</div>
				</div>
				
			</div>
		</div>
	</nav>
	<!-- The Modal -->
	<div id="checkModal" class="modal">

		<!-- Modal content -->
		<div class="modal-content">
		<span class="close">&times;</span>
		<p>Please update your profile first to get order for medicines</p>
		<!-- <div class="g-signin2" data-onsuccess="onSignIn" data-theme="dark"></div> -->
		</div>
	
	</div>
	
<div class="container-fluid">
<ul class="nav nav-tabs">
    <li class="active"><a data-toggle="tab" href="#demands">Demands</a></li>
    <li><a data-toggle="tab" href="#accepted-orders">Accepted Orders</a></li>
    <li><a data-toggle="tab" href="#delivered-orders">Delivered Orders</a></li>
    <li><a data-toggle="tab" href="#profile">Profile</a></li>
  </ul>

  <div class="tab-content">
    <div id="demands" class="tab-pane fade in active">
      <div id="fh5co-about">
		<div class="container">
			<div class="row animate-box">
				<div class="col-md-8 col-md-offset-2 text-center fh5co-heading">
					<h2>View Demands</h2>
					<!-- <p>Dignissimos asperiores vitae velit veniam totam fuga molestias accusamus alias autem provident. Odit ab aliquam dolor eius.</p> -->
				</div>
			</div>
			<div class="row">
				<div class="member">
					<div class="member">
						<div class="col-md-1 nopadding animate-box">
						</div>
						<div class="col-md-10 nopadding animate-box" style="border: 1px solid #000;">
						<div id="demandList" class="desc" style="margin-top:1em;height: 600px;margin-top:0;padding:1em;width:100%; overflow-y: auto;">
							<div id="demand_body">
							<div class="row">
								<div class="col-md-9">
									<h3>[[full_address]]</h3>
									<p>[[comment]]</p>
									<p>[[time]]</p>
								</div>
								<div style="float: none;" class="col-md-3">
									<a href="#"><button class="btn btn-primary" id="[[_id]]" onclick="demandDetail(this.id)">View details</button></a>
								</div>
							</div>
							</div>
						</div>
					</div>
						<div class="col-md-1 nopadding animate-box">
						</div>
					</div>
				</div>
				
				
			</div>
		</div>
	</div>
    </div>
    <div id="accepted-orders" class="tab-pane fade">
      <div id="fh5co-about">
		<div class="container">
			<div class="row animate-box">
				<div class="col-md-8 col-md-offset-2 text-center fh5co-heading">
					<h2>Accepted Orders</h2>
					<!-- <p>Dignissimos asperiores vitae velit veniam totam fuga molestias accusamus alias autem provident. Odit ab aliquam dolor eius.</p> -->
				</div>
			</div>
			<div class="row">
				<div class="member">
					<div class="member">
						<div class="col-md-1 nopadding animate-box">
						</div>
						<div class="col-md-10 nopadding animate-box" style="border: 1px solid #000;">
						<div id="acceptedList" class="desc" style="margin-top:1em;height: 600px;margin-top:0;padding:1em;width:100%; overflow-y: auto;">
							<div id="accepted_body">
							<div class="row">
								<div class="col-md-9">
									<h3>[[]]</h3>
									<p>[[]]</p>
									<p>[[]]</p>
								</div>
								<div class="col-md-3">
									<button class="btn btn-primary" id="[[_id]]" onclick="acceptedOrderDetail(this.id)">View details</button>
								</div>
							</div>
							</div>
						</div>
					</div>
						<div class="col-md-1 nopadding animate-box">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
    </div>
    <div id="delivered-orders" class="tab-pane fade">
      <div id="fh5co-about">
		<div class="container">
			<div class="row animate-box">
				<div class="col-md-8 col-md-offset-2 text-center fh5co-heading">
					<h2>Delivered Orders</h2>
					<!-- <p>Dignissimos asperiores vitae velit veniam totam fuga molestias accusamus alias autem provident. Odit ab aliquam dolor eius.</p> -->
				</div>
			</div>
			<div class="row">
				<div class="member">
					<div class="col-md-1 nopadding animate-box">
					</div>
					<div class="col-md-10 nopadding animate-box" style="border: 1px solid #000;">
						<div id="deliveredList" class="desc" style="margin-top:1em;height: 600px;margin-top:0;padding:1em;width:100%; overflow-y: auto;">
							<div id="delivered_body">
							<div class="row">
								<div class="col-md-9">
									<h3>[[patient_name]]</h3>
									<p>[[patient_age]]</p>
									<p>[[time_slab]]</p>
								</div>
								<div class="col-md-3">
									<button class="btn btn-primary" id=[[_id]] onclick="deliveredOrderDetail(this.id)">View details</button>
								</div>
							</div>
							</div>
						</div>
					</div>
					<div class="col-md-1 nopadding animate-box">
					</div>
				</div>		
			</div>
		</div>
	</div>
    </div>
    <div id="profile" class="tab-pane fade">
			<div class="row" style="padding : 50px 0">
			  <div class="col-md-3">
	  
			  </div>
			  <div class="col-md-6" style="background : #eee"> 
				  <div id="profile_body" class="row" style="padding : 25px">
					  <div class="col-md-3" style="border: 1px solid white">
						  <img class="img-responsive" id="ret_image" alt="">
					  </div>
					  <div class="col-md-9" style="border: 1px solid white;">
						  <!-- retailer details -->
						  <table class="table table-striped">
								<tbody>
									<tr>
										<td>Name : </td>
										<td>[[name]]</td>
									</tr>
									<tr>
										<td>Email :</td>
										<td>[[email]]</td>
									</tr>
									<tr>
										<td>House Number :</td>
										<td>[[house_no]]</td>
									</tr>
									<tr>
										<td>Landmark :</td>
										<td>[[landmark]]</td>
									</tr>
									<tr>
										<td>City :</td>
										<td>[[city]]</td>
									</tr>
									<tr>
										<td>State :</td>
										<td>[[state]]</td>
									</tr>
									<tr>
										<td>PINCODE :</td>
										<td>[[pincode]]</td>
									</tr>
									<tr>
										<td>Shop Name :</td>
										<td>[[shop_name]]</td>
									</tr>
									<tr>
										<td>Shop Contact :</td>
										<td>[[phone_number]]</td>
									</tr>
								</tbody>
							</table>
						  <!-- <p>Contact</p> -->
						  <!-- <button id="add_address" onclick="showAddressForm()" class="btn btn-default">Add Address</button> -->
	  
						  <div class="row"  id="addRetDetail" style="display : none;">
							  <div class="col-md-12">
								  <form>
								  <div class="form-group">
									  <label for="usr">House Number :</label>
									  <input type="text" class="form-control" name="house_no">
								  </div>
								  <div class="form-group">
									  <label for="pwd">Landmark :</label>
									  <input type="text" class="form-control" name="landmark">
								  </div> 
								  <div class="form-group">
									  <label for="pwd">City :</label>
									  <input type="text" class="form-control" name="city">
								  </div> 
								  <div class="form-group">
									  <label for="pwd">State :</label>
									  <input type="text" class="form-control" name="state">
								  </div> 
								  <div class="form-group">
									  <label for="pwd">PINCODE :</label>
									  <input type="text" class="form-control" name="pincode">
								  </div>
								  <div class="form-group">
									<label for="pwd">Shop Phone Number :</label>
									<input type="text" class="form-control" name="phone_number">
								  </div>
								  <div class="form-group">
									<label for="pwd">Personal Phone Number :</label>
									<input type="text" class="form-control" name="phone_number">
								  </div>
								  <div class="form-group">
									<label for="pwd">Shop Name :</label>
									<input type="text" class="form-control" name="shop_name">
								  </div>
								  <button type="button" onclick="sendRetDetail()" class="btn btn-primary">Update</button>
								  </form>
							  </div>
						  </div>
	  
	  
					  </div>
				  </div>
	  
			  </div>
			  <div class="col-md-3">
	  
			  </div>
			</div>
		  </div>
  </div>
</div>

    <footer id="fh5co-footer" role="contentinfo">
		<div class="container">
			<div class="row row-pb-md">
				<div class="col-md-4 fh5co-widget">
					<h4>ApnaOPD</h4>
					<p>Facilis ipsum reprehenderit nemo molestias. Aut cum mollitia reprehenderit. Eos cumque dicta adipisci architecto culpa amet.</p>
				</div>
				<div class="col-md-4 col-md-push-1">
					<h4>Links</h4>
					<ul class="fh5co-footer-links">
						<li><a href="index.html">Home</a></li>
						<li><a href="#">About us</a></li>
					</ul>
				</div>

				<div class="col-md-4 col-md-push-1">
					<h4>Contact Information</h4>
					<ul class="fh5co-footer-links">
						<li>Adityapur ,Jamshedpur <br>JH  INDIA 831012</li>
						<li><a href="tel://1234567920">+ 1235 2355 98</a></li>
						<li><a href="mailto:info@yoursite.com">email : ApnaOPD</a></li>
					</ul>
				</div>

			</div>

			<div class="row copyright">
				<div class="col-md-12 text-center">
					<p>
						<small class="block">&copy; 2018 ApnaOPD. All Rights Reserved.</small> 
						<!-- <small class="block">Designed by <a href="http://freehtml5.co/" target="_blank">FreeHTML5.co</a> Demo Images: <a href="http://unsplash.co/" target="_blank">Unsplash</a></small> -->
					</p>
					<p>
						<ul class="fh5co-social-icons">
							<li><a href="#"><i class="icon-facebook"></i></a></li>
							<li><a href="#"><i class="icon-linkedin"></i></a></li>
							<li><a href="#"><i class="icon-dribbble"></i></a></li>
						</ul>
					</p>
				</div>
			</div>

		</div>
	</footer>
	</div>

	<div class="gototop js-top">
		<a href="#" class="js-gotop"><i class="icon-arrow-up"></i></a>
	</div>
	
	<!-- jQuery -->
	<script src="js/jquery.min.js"></script>
	<!-- jQuery Easing -->
	<script src="js/jquery.easing.1.3.js"></script>
	<!-- Bootstrap -->
	<script src="js/bootstrap.min.js"></script>
	<!-- Waypoints -->
	<script src="js/jquery.waypoints.min.js"></script>
	<!-- Flexslider -->
	<script src="js/jquery.flexslider-min.js"></script>
	<!-- Magnific Popup -->
	<script src="js/jquery.magnific-popup.min.js"></script>
	<script src="js/magnific-popup-options.js"></script>
	<!-- Main -->
	<script src="js/main.js"></script>
	<script src="js/login_module.js"></script>

	<script>
		// Get the modal
		var modal = document.getElementById('checkModal');
		// var retailer_gid = sessionStorage.getItem('retailer_gid');
		// Get the <span> element that closes the modal
		var span = document.getElementsByClassName("close")[0];

		// When the user clicks the button, open the modal 
		var gid = sessionStorage.getItem('retailer_gid');
		$.get("http://192.168.43.193:3000/api/retailers/"+gid,function(res){
			if(res.address=='' || res.address == null)
			{
				modal.style.display = "block";
				$("#addRetDetail").show();
			}
			else {
				console.log(res);
				res.house_no = res.address.house_no;
				res.landmark = res.address.landmark;
				res.city = res.address.city;
				res.state = res.address.state;
				res.pincode = res.address.pincode;
				res.phone_number = res.address.phone_number;
				$("#profile_body").mirandajs(res);
			}
		});
		// When the user clicks on <span> (x), close the modal
		span.onclick = function() {
			modal.style.display = "none";
		}

		// When the user clicks anywhere outside of the modal, close it
		window.onclick = function(event) {
			if (event.target == modal) {
				modal.style.display = "none";
			}
		}

		function sendRetDetail() {
		var addrr = $("#addRetDetail form").serializeArray();
		var obj={};
		var finalObj={};
		console.log(addrr);
		for(i=0;i<6;i++)
		{
			obj[addrr[i].name] = addrr[i].value;
			//console.log(addrr[i].name, addrr[i].value);
		}
		console.log("Address object",obj);
		finalObj["address"] = obj;
		for(i=6;i<addrr.length;i++) {
			finalObj[addrr[i].name] = addrr[i].value;
		}
		console.log("Final object to be sent",finalObj);

		$.ajax({
				type        : 'PUT', 
				url         : 'http://192.168.43.193:3000/api/retailers/profile/'+gid,
				contentType : "application/json",
				data        : JSON.stringify(finalObj),
				dataType    : 'json',
				encode      : true
			})
			.done(function(data) {
				console.log(data);
				alert("Details updated successfully!");
				window.location.href = "profile_retailer.html";
		});

	}

	$.get("http://192.168.43.193:3000/api/users/"+gid,function(res){
		imageUrl = res.imageUrl;
		$("#ret_image").attr("src", imageUrl);
	});
	
	</script>

	<script src="js/jquery.miranda.min.js"></script>




	<script>
		// get demands
		$.ajax({

		        type        : 'GET', 
		        url         : 'http://192.168.43.193:3000/api/retailers/orders/'+gid
		    })
		    .done(function(data) {
		    	// console.log(data);
		    	for (var i = 0; i < data.length; i++) {
		    		//console.log(data[i].address.pincode);
		    		var full_address = data[i].address.full_name + "," + data[i].address.house_no + "," + data[i].address.landmark + "," + data[i].address.city + "," + data[i].address.state + "," + data[i].address.pincode;
		    		data[i]['full_address'] = full_address;
				}
				//console.log('changed',data);
		    	$('#demandList').mirandajs(data);
		    	
		});

		function demandDetail(selected_demandid) {
			sessionStorage.setItem('demand_id', selected_demandid);
			window.location.href = "retailer_order_detail.html";
		}

		function deliveredOrderDetail(delivered_order_id) {
			sessionStorage.setItem('delivered_order_id',delivered_order_id);
			window.location.href = "retailer_delivered_order.html";
		}

		function acceptedOrderDetail(accepted_order_id) {
			sessionStorage.setItem('accepted_order_id',accepted_order_id);
			window.location.href = "retailer_accepted_order.html";
		}


		// get offers accepted by user

		$.ajax({

		        type        : 'GET', 
		        url         : 'http://192.168.43.193:3000/api/orders/retailer/'+gid
		        //data        : e_presc,
		        //dataType    : 'json',
		        //encode      : true
		    })
		    .done(function(data) {
		    	console.log("accepted offers",data);
		    	$('#acceptedList').mirandajs(data);	
		});




		// get delivered orders
		$.ajax({

				type        : 'GET', 
				url         : 'http://192.168.43.193:3000/api/retailers/history/'+gid
				})
				.done(function(data) {
					console.log("Delivered orders",data);
					$('#deliveredList').mirandajs(data);
				});
	</script>
	</body>
</html>